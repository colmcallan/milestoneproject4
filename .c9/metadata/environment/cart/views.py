{"filter":false,"title":"views.py","tooltip":"/cart/views.py","undoManager":{"mark":-1,"position":-1,"stack":[[{"start":{"row":15,"column":30},"end":{"row":15,"column":31},"action":"remove","lines":["/"],"id":17},{"start":{"row":15,"column":29},"end":{"row":15,"column":30},"action":"remove","lines":["s"]},{"start":{"row":15,"column":28},"end":{"row":15,"column":29},"action":"remove","lines":["e"]},{"start":{"row":15,"column":27},"end":{"row":15,"column":28},"action":"remove","lines":["t"]},{"start":{"row":15,"column":26},"end":{"row":15,"column":27},"action":"remove","lines":["a"]},{"start":{"row":15,"column":25},"end":{"row":15,"column":26},"action":"remove","lines":["l"]},{"start":{"row":15,"column":24},"end":{"row":15,"column":25},"action":"remove","lines":["p"]},{"start":{"row":15,"column":23},"end":{"row":15,"column":24},"action":"remove","lines":["m"]},{"start":{"row":15,"column":22},"end":{"row":15,"column":23},"action":"remove","lines":["e"]},{"start":{"row":15,"column":21},"end":{"row":15,"column":22},"action":"remove","lines":["t"]}],[{"start":{"row":58,"column":30},"end":{"row":58,"column":31},"action":"remove","lines":["/"],"id":16},{"start":{"row":58,"column":29},"end":{"row":58,"column":30},"action":"remove","lines":["s"]},{"start":{"row":58,"column":28},"end":{"row":58,"column":29},"action":"remove","lines":["e"]},{"start":{"row":58,"column":27},"end":{"row":58,"column":28},"action":"remove","lines":["t"]},{"start":{"row":58,"column":26},"end":{"row":58,"column":27},"action":"remove","lines":["a"]},{"start":{"row":58,"column":25},"end":{"row":58,"column":26},"action":"remove","lines":["l"]},{"start":{"row":58,"column":24},"end":{"row":58,"column":25},"action":"remove","lines":["p"]},{"start":{"row":58,"column":23},"end":{"row":58,"column":24},"action":"remove","lines":["m"]},{"start":{"row":58,"column":22},"end":{"row":58,"column":23},"action":"remove","lines":["e"]},{"start":{"row":58,"column":21},"end":{"row":58,"column":22},"action":"remove","lines":["t"]}],[{"start":{"row":58,"column":21},"end":{"row":58,"column":22},"action":"insert","lines":["t"],"id":15},{"start":{"row":58,"column":22},"end":{"row":58,"column":23},"action":"insert","lines":["e"]},{"start":{"row":58,"column":23},"end":{"row":58,"column":24},"action":"insert","lines":["m"]},{"start":{"row":58,"column":24},"end":{"row":58,"column":25},"action":"insert","lines":["p"]},{"start":{"row":58,"column":25},"end":{"row":58,"column":26},"action":"insert","lines":["l"]},{"start":{"row":58,"column":26},"end":{"row":58,"column":27},"action":"insert","lines":["a"]},{"start":{"row":58,"column":27},"end":{"row":58,"column":28},"action":"insert","lines":["t"]},{"start":{"row":58,"column":28},"end":{"row":58,"column":29},"action":"insert","lines":["e"]},{"start":{"row":58,"column":29},"end":{"row":58,"column":30},"action":"insert","lines":["s"]},{"start":{"row":58,"column":30},"end":{"row":58,"column":31},"action":"insert","lines":["/"]}],[{"start":{"row":15,"column":23},"end":{"row":15,"column":24},"action":"insert","lines":["m"],"id":14},{"start":{"row":15,"column":24},"end":{"row":15,"column":25},"action":"insert","lines":["p"]},{"start":{"row":15,"column":25},"end":{"row":15,"column":26},"action":"insert","lines":["l"]},{"start":{"row":15,"column":26},"end":{"row":15,"column":27},"action":"insert","lines":["a"]},{"start":{"row":15,"column":27},"end":{"row":15,"column":28},"action":"insert","lines":["t"]},{"start":{"row":15,"column":28},"end":{"row":15,"column":29},"action":"insert","lines":["e"]},{"start":{"row":15,"column":29},"end":{"row":15,"column":30},"action":"insert","lines":["s"]},{"start":{"row":15,"column":30},"end":{"row":15,"column":31},"action":"insert","lines":["/"]}],[{"start":{"row":15,"column":26},"end":{"row":15,"column":27},"action":"remove","lines":["l"],"id":13},{"start":{"row":15,"column":25},"end":{"row":15,"column":26},"action":"remove","lines":["p"]},{"start":{"row":15,"column":24},"end":{"row":15,"column":25},"action":"remove","lines":["m"]},{"start":{"row":15,"column":23},"end":{"row":15,"column":24},"action":"remove","lines":["a"]}],[{"start":{"row":15,"column":21},"end":{"row":15,"column":22},"action":"insert","lines":["t"],"id":12},{"start":{"row":15,"column":22},"end":{"row":15,"column":23},"action":"insert","lines":["e"]},{"start":{"row":15,"column":23},"end":{"row":15,"column":24},"action":"insert","lines":["a"]},{"start":{"row":15,"column":24},"end":{"row":15,"column":25},"action":"insert","lines":["m"]},{"start":{"row":15,"column":25},"end":{"row":15,"column":26},"action":"insert","lines":["p"]},{"start":{"row":15,"column":26},"end":{"row":15,"column":27},"action":"insert","lines":["l"]}],[{"start":{"row":15,"column":25},"end":{"row":15,"column":26},"action":"remove","lines":["/"],"id":11},{"start":{"row":15,"column":24},"end":{"row":15,"column":25},"action":"remove","lines":["t"]},{"start":{"row":15,"column":23},"end":{"row":15,"column":24},"action":"remove","lines":["r"]},{"start":{"row":15,"column":22},"end":{"row":15,"column":23},"action":"remove","lines":["a"]},{"start":{"row":15,"column":21},"end":{"row":15,"column":22},"action":"remove","lines":["c"]}],[{"start":{"row":58,"column":21},"end":{"row":58,"column":22},"action":"remove","lines":["/"],"id":10}],[{"start":{"row":58,"column":24},"end":{"row":58,"column":25},"action":"remove","lines":["t"],"id":9},{"start":{"row":58,"column":23},"end":{"row":58,"column":24},"action":"remove","lines":["r"]},{"start":{"row":58,"column":22},"end":{"row":58,"column":23},"action":"remove","lines":["a"]},{"start":{"row":58,"column":21},"end":{"row":58,"column":22},"action":"remove","lines":["c"]}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["from django.utils import timezone",""],"id":8}],[{"start":{"row":5,"column":35},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":7}],[{"start":{"row":2,"column":36},"end":{"row":3,"column":0},"action":"remove","lines":["",""],"id":6}],[{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["from django.http import JsonResponse",""],"id":5}],[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["from django.views.generic import View",""],"id":4}],[{"start":{"row":0,"column":54},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":3}],[{"start":{"row":6,"column":0},"end":{"row":54,"column":61},"action":"remove","lines":["@login_required","def view_cart(request):","    \"\"\"Route to allow users to view their cart contents\"\"\"","    return render(request, \"cart.html\")","    ","","@login_required","def add_to_cart(request, id):","    \"\"\"Add a ticket to the cart for upvoting\"\"\"","    quantity = int(request.POST.get('quantity'))","    ticket_id = request.POST.get('id')","    cart = request.session.get('cart', {})","    for k,v in cart.items():","        if k == ticket_id:","            messages.error(request, \"Sorry {0}, that ticket is already in your cart\".format(request.user), extra_tags=\"alert-primary\")","    cart[id] = cart.get(id, quantity)","    request.session['cart'] = cart","    return redirect(request.META.get('HTTP_REFERER'))","    ","","def increase_cart(request, id):","    \"\"\"Increase the quantity of the cart_item\"\"\"","    cart = request.session.get('cart', {})","    if cart[id]:","        cart[id] += 1","    request.session['cart'] = cart","    return redirect(request.META.get('HTTP_REFERER'))","    ","","def decrease_cart(request, id):","    \"\"\"Decrease the quantity of the cart_item\"\"\"","    cart = request.session.get('cart', {})","    if cart[id]:","        cart[id] -= 1","    request.session['cart'] = cart","    if cart[id] == 0:","        cart.pop(id)","    return redirect(request.META.get('HTTP_REFERER'))","    ","   ","def remove_from_cart(request, id):","    \"\"\"Remove a ticket from the cart view\"\"\"","    ticket_id = request.POST.get('id')","    cart = request.session.get('cart', {})","    for k,v in cart.items():","        if ticket_id in k:","            cart.pop(k)","            request.session['cart'] = cart","            return redirect(request.META.get('HTTP_REFERER'))"],"id":2},{"start":{"row":6,"column":0},"end":{"row":71,"column":62},"action":"insert","lines":["","class CartListView(View):","    \"\"\"","    returns cart html page","    \"\"\"","    template_name = 'cart/cart.html'","    context = {}","","    def get(self, request, *args, **kwargs):","        return render(request, self.template_name, self.context)","","","class CartCreateView(View):","    \"\"\"","    only used for post requests, is called from javascript to","    add items to the cart, sets up the session 'cart'","    for the context processor on the next page refresh.","    \"\"\"","","    def post(self, request, *args, **kwargs):","","        # get session 'cart' or create a default empty one","        cart = request.session.get('cart', {'cart_items': [], 'cart_count': 0, 'cart_votes': 0, 'cart_total': 0})","","        # add item to cart list, timestamp will be a","        # unique identifier for duplicate votes (which are allowed)","        cart_item = {","            'id': int(request.POST.get('id')),","            'votes': int(request.POST.get('votes')),","            'value': int(request.POST.get('value')),","            'timestamp': timezone.now().isoformat(),","        }","","        cart['cart_items'].append(cart_item)","        cart['cart_count'] += 1","        cart['cart_total'] += int(request.POST.get('value'))","","        # assign back to session 'cart' and return response","        request.session['cart'] = cart","        return JsonResponse({'cart': request.session['cart']})","","","class CartUpdateView(View):","    \"\"\"","    only used for post requests, is called from javascript to","    remove items to the cart, sets up the session 'cart'","    for the context processor on the next page refresh.","    \"\"\"","    template_name = 'cart/cart.html'","    context = {}","","    def post(self, request, *args, **kwargs):","        \"\"\"","         a list of timestamps of still relevant cart items are posted from","         the front end, processed and sent back triggering a page refresh","        \"\"\"","        cart = request.session.get('cart', None)","        tickets = request.POST.get('data').replace(' ', '+').split(',')","","        # only add items to the cart if the timestamp is in the posted list,","        # otherwise they have been removed by the user","        cart['cart_items'] = [item for item in cart['cart_items'] if item['timestamp'] in tickets]","","        # return session 'cart' and json response","        request.session['cart'] = cart","        return JsonResponse({'cart': request.session['cart']})"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":48,"column":38},"end":{"row":48,"column":38},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1566469724958,"hash":"0ce8f476e02f2d156d28aef5c239b0306e4e9271"}